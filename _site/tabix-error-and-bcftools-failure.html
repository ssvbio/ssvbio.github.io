<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>GenomeBio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="/js/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="/css/theme.css" rel="stylesheet" type="text/css">
  <link href="/css/syntax.css" rel="stylesheet" type="text/css">
</head>

<body>
  <nav class="navbar-fixed-top bg-primary">
    <span class="navbar-brand">Bioinformatics notes from a biologist</span>
    <ul class="nav navbar-nav">
      <li class="active"><a href="/">Home</a></li>
      <li class="active"><a href="/archive.html">Archive</a></li>
    </ul>
  </nav>
  
</body>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-3 hidden-xs">
            <div class=well>
  <div class="sidebar">
    22 September 2020
  </div>
  <div class="sidebar">
    <h1>Recent Posts</h1>
    <ul>
        
          <li><a href="/rename-files-from-file">Batch rename files from a file</a></li>
        
          <li><a href="/one-liners-in-bioinformatics">One liners in bioinformatics (ever updating)</a></li>
        
          <li><a href="/remove-named-columns-from-several-files">Remove named columns from several files</a></li>
        
          <li><a href="/reorganize-and-rename-fasta">Reorganize and rename fasta</a></li>
        
          <li><a href="/tidy-pivot-longer-matching-pairs-of">Clean data with altenating match pair columns</a></li>
        
    </ul>
  </div>
  <div class="sidebar">
    <h1>Links</h1>
<ul>
  <li><a target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/svsk/">Linkedin</a></li>
  <li><a target="_blank" rel="noopener noreferrer" href="https://www.github.com/svsuresh">Github</a></li>
</ul>

  </div>
</div>
        </div>
        <div class="col-md-9">
          <div class="article">
            <div class="well">
                <h1><a href="/tabix-error-and-bcftools-failure">Aug 15, 2020 - Tabix error and bcftools failure in handling unsorted vcf</a></h1>
            <div class="post-content">
            <p style="text-align: justify;">Sometimes, established tools drive us nuts. Following is an example. I have a vcf that is not sorted. Download it from <a href="https://drive.google.com/file/d/1AmBQOlt2sLn68Dfduv-y50S5_0aSQKfd/view?usp=sharing">here</a> (bgzipped, please un-gzip for the use) .Now let us follow the standard procedure to index this unsorted file.</p><ol style="text-align: justify;"><li>bgzip the file</li><li>Use tabix to index the file.&nbsp;</li></ol><p style="text-align: justify;">Now you would get following error:</p><p style="text-align: justify;">========================================</p><p style="text-align: justify;">$ tabix -p vcf ref.vcf.gz <br />[ti_index_core] the file out of order at line 59</p><p style="text-align: justify;">==========================================</p><p style="text-align: justify;">Since VCF is not sorted, tabix is throwing this error. Next logical step would be to use bcftools (I am using bcftools 1.10.2) to sort the vcf using "sort" function. Now run bcftools to sort the vcf. Following error you would get:</p><p style="text-align: justify;">=============================================================== <br /></p><p style="text-align: justify;">$ bcftools sort ref.vcf.gz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />Writing to /tmp/bcftools-sort.RNcNFP<br />[W::vcf_parse] Contig '1' is not defined in the header. (Quick workaround: index the file with tabix.)<br />Error encountered while parsing the input at 1:207684192<br />Cleaning<br />==============================================================</p><p style="text-align: justify;">Where should user go now? Tabix fails because vcf is not sorted and bcftools fails that chromosome number is not defined in header and fails to sort because of that. In addition to failing, it is suggesting user to use a tool that fails because of sorting.&nbsp;</p><p style="text-align: justify;">Fortunately, vcftools comes to the rescue. <br />===========================<br />$ vcf-sort ref.vcf.gz<br />===========================</p><p style="text-align: justify;">This populates vcf that can be used for indexing and tabix works as intended now, as the vcf is sorted. <br /></p>
            </div>
          </div>
          <div class="pagination">
              
                <a class="btn btn-default" href="/annotate-text-file-with-dbsnp-reference" class="next">Newer Post</a>
              
              
                <a class="btn btn-default" href="/text_to_rsid" class="previous">Older Post</a>
              
          </div>
        </div>
    </div>
</div>

<body>
<html>	
<div class="container-fluid">
    <div class="row-fluid">
        <div class="span12 footer navbar-inverse navbar-fixed-bottom">
            <p class="copyright">&copy;2020 GenomeBio. Powered by <a href="http://jekyllrb.com">Jekyll</a>, theme by <a href="https://github.com/scotte/jekyll-clean">Scott Emmons</a>
            under
            <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution</a></p>
        </div>
    </div>
</div>

</body>
</html>

